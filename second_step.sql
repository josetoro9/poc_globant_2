----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------
-------------------------------------------------------NUMBER 2-------------------------------------------------
----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------
with adaptation as (
    select
        id,
        MONTH(datetime) as month,
        IFNULL(department_id, 0) as department_id,
        IFNULL(job_id, 0) as job_id
    from
        mydatabase.hired_employees_mod
),
conteos as (
    select
        department_id,
        count(*) as conteo
    from
        adaptation
    group by
        1
),
promedio as (
    select
        avg(conteo) as prom
    from
        conteos
),
conditions as (
    select
        a.*
    from
        conteos a
    where
        conteo > (
            select
                prom
            from
                promedio
        )
)
select
    a.department_id as id,
    IFNULL(b.department, 'NA') as department,
    conteo as hired
from
    conditions a
    left join mydatabase.departments b on a.department_id = IFNULL(b.id, 0)
order by
    conteo desc